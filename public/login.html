<!DOCTYPE html>
<html>
<head>
    <title>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
            <p>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
        </div>
        
        <div class="content">
            <div id="message" class="message error" style="display: none;"></div>
            
            <form id="loginForm">
                <div class="form-group ">
                    <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" required>
                
                </div>
                
                <div class="form-group password-wrapper">
                    <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required
                    minlength="8"
                    pattern="^(?=.*[0-9!@#$%^&*]).{8,}$"
                    title="–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ü–∏—Ñ—Ä—ã –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã !@#$%^&*">
                    <button type="button" class="toggle-password" id="togglePassword" title="–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å">üëÅÔ∏è</button>
                </div>
                
                <button type="submit" class="btn">–í–æ–π—Ç–∏</button>
            </form>
            
            <div class="links">
                <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="register.html">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
                <p><a href="index.html">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a></p>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const message = document.getElementById('message');
            
            // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            message.style.display = 'none';
            
            try {
                // –ó–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞—à —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                // –æ–Ω –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è /auth/login
                const response = await fetch('/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('token', data.access_token);
                    
                    // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                    window.location.href = 'index.html';
                } else {
                    const error = await response.json();
                    message.textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                    message.style.display = 'block';
                }
            } catch (error) {
                message.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message;
                message.style.display = 'block';
            }
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('token');
            if (token) {
                window.location.href = 'index.html';
                console.log('token')
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('password'); 
            const toggleButton = document.getElementById('togglePassword'); 

            toggleButton.addEventListener('click', function(){
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text'; 
                    this.textContent = 'üëÅÔ∏è‚Äçüó®Ô∏è'; 
                    this.title = '–°–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å'; 
                } else {
                    passwordInput.type = 'password'; 
                    this.textContent = 'üëÅÔ∏è', 
                    this.title = '–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞—Ä–æ–ª—å'; 
                }
                passwordInput.focus(); 
            })
        })
    </script>
</body>
</html>